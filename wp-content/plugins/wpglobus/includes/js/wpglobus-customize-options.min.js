jQuery(document).ready(function(c){"use strict";var u={listID:"#wpglobus-sortable",customizeSave:!1,customizeSaveData:"",init:function(){c("#wpglobus-sortable").sortable({update:u.sortUpdate}),u.setJSCodeSection(),u.addListeners(),u.ajaxListener()},setJSCodeSection:function(){var o=WPGlobusCustomizeOptions.settings.wpglobus_js_editor_section;void 0!==o&&void 0!==o.wpglobus_customize_js_editor&&(c("#customize-control-wpglobus_customize_js_editor .customize-control-title").css({width:"50%"}).after('<span class="wpglobus-customize-js-editor-expand" style="float:right;"><a href="#">'+WPGlobusCustomizeOptions.i18n.expandShrink+"</a></span>"),c(document).on("click",".wpglobus-customize-js-editor-expand",function(o){var e=c(this),t=c("#customize-controls");e.toggleClass("expanded"),e.hasClass("expanded")?t.css({width:"500px"}):t.css({width:""})}),c("#sub-accordion-section-wpglobus_js_editor_section .customize-section-back").on("click",function(o){c("#customize-controls").css({width:""}),c(".wpglobus-customize-js-editor-expand").removeClass("expanded")}))},addListeners:function(){c("body").on("change",".wpglobus-listen-change",function(o){u.setState(!1)}),c("body").on("change","#wpglobus-sortable input.wpglobus-language-item",function(o){var e=c(this);e.prop("checked")||u.removeLanguage(e)}),c("#customize-control-wpglobus_add_languages_select_box select").on("change",function(o){u.addLanguage(o,this)}),c("#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title").off("click keydown"),c("body").on("click","#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_addons_section+" .accordion-section-title",function(o){window.open(WPGlobusCustomizeOptions.addonsPage,"_blank")}),c(document).on("click","#"+WPGlobusCustomizeOptions.userControlSaveButton,function(){u.userControlAjax(this)}),c(document).on("click","#accordion-section-"+WPGlobusCustomizeOptions.sections.wpglobus_js_editor_section+" .accordion-section-title",function(o){c("#customize-control-wpglobus_customize_js_editor .CodeMirror").css({height:"40em"})})},removeLanguage:function(o){var e=o.data("language"),t=c("#customize-control-wpglobus_add_languages_select_box select option").eq(0);c('<option value="'+e+'">'+WPGlobusCustomizeOptions.config.language_name[e]+" ("+WPGlobusCustomizeOptions.config.en_language_name[e]+") </option>").insertAfter(t),o.parent("li").remove()},addLanguage:function(o,e){var t,s=c(e).attr("value"),n=c("#wpglobus-item-skeleton").html(),i="",a=c(u.listID+" li").attr("class");"select"!=s&&(i=(i=(i=(i=(i=(i=(i=(i=(i=n.replace("{{flag}}",'src="'+WPGlobusCustomizeOptions.config.flags_url+WPGlobusCustomizeOptions.config.flag[s]+'"')).replace("{{name}}",s)).replace("{{id}}",s)).replace('checked="{{checked}}"','checked="checked"')).replace('disabled="{{disabled}}"',"")).replace("{{item}}",WPGlobusCustomizeOptions.config.en_language_name[s]+" ("+s+") ")).replace("{{order}}","#")).replace("{{language}}",s)).replace("{{edit-link}}",WPGlobusCustomizeOptions.editLink.replace("{{language}}",s)),c('<li class="'+a+'">'+i+"</li>").appendTo(u.listID),u.setOrder(),t=c(e).find("option"),c.each(t,function(o,e){c(e).attr("value")==s&&c(e).remove()}))},sortUpdate:function(o,e){u.setState(!1),u.setOrder()},setOrder:function(){c("#wpglobus-sortable input.wpglobus-language-item").each(function(o,e){var t=c(e);0==o?t.prop("disabled","disabled").prop("checked","checked"):t.removeProp("disabled"),t.data("order",o)})},setState:function(o){wp.customize.state("saved").set(o)},getCustomizeSaveData:function(){return u.customizeSaveData},enabledUserControl:function(o){return void 0!==WPGlobusCustomize.controlInstances[o]&&WPGlobusCustomize.controlInstances[o].userControl.enabled},userControlAjax:function(o){c(o).prop("disabled",!0);var n={action:"cb-controls-save",controls:{}};c(".wpglobus-customize-cb-control").each(function(o,e){var t,s=c(e);s.prop("checked")||(t=(t=(t=s.data("control")).replace("[","{{")).replace("]","}}"),n.controls[t]="disable")}),c.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:n},dataType:"json"}).always(function(){location.reload(!0)})},ajax:function(o,e){var i;"wpglobus_customize_save"==o&&(i={action:"wpglobus_customize_save",options:{}},c.each(WPGlobusCustomizeOptions.settings,function(o,e){c.each(e,function(o,t){return"wpglobus_customize_enabled_languages"==o?(i.options[t.option]={},c("#wpglobus-sortable input.wpglobus-language-item").each(function(o,e){i.options[t.option][c(this).data("language")]="1"}),!0):void(-1!=u.customizeSaveData.indexOf("wpglobus_customize_post_type_")&&-1!=o.indexOf("wpglobus_customize_post_type_")?(void 0===i.options[t.option]&&(i.options[t.option]={}),i.options[t.option][o.replace("wpglobus_customize_post_type_","")]=c("#customize-control-"+o+" input").prop("checked")?1:0):-1!=u.customizeSaveData.indexOf(o)&&(e=c("#customize-control-"+o+" "+t.type),s="","textarea"==t.type?s=e.val():"wpglobus_checkbox"==t.type?(e=c("#customize-control-"+o+" input"),s="wpglobus_customize_selector_wp_list_pages"==o?e.prop("checked")?1:0:e.prop("checked")?1:""):"checkbox"==t.type?s=e.prop("checked")?1:"":"select"==t.type?s=e.val():"code_editor"!=t.type||void 0!==(n=wp.customize.control.instance(o))&&(s=n.setting()),i.options[t.option]=s,"code_editor"==t.type&&void 0===n&&delete i.options[t.option]));var e,s,n})})),c.ajax({beforeSend:function(){},type:"POST",url:WPGlobusCustomizeOptions.ajaxurl,data:{action:WPGlobusCustomizeOptions.process_ajax,order:i},dataType:"json"})},getChangesetData:function(o){if(void 0!==o){var e=/customize_changeset_data=([^&]+)/.exec(o);if(void 0===e[1])return;var t,s=decodeURIComponent(e[1]),n=JSON.parse(s);c.each(n,function(o,e){void 0!==WPGlobusCustomize.controlInstances[o]&&(t="",t=(WPGlobusCustomize.controlInstances[o].type,WPGlobusCustomize.controlInstances[o].setting),n[o].value=t)});var i=JSON.stringify(n);i=(i=encodeURIComponent(i)).replace(/%20/g,"+"),o=o.replace(e[1],i)}return o},ajaxListener:function(){c(document).on("ajaxSend",function(o,e,t){void 0!==t.data&&-1!=t.data.indexOf("wp_customize=on")&&-1!=t.data.indexOf("action=customize_save")&&(-1!=t.data.indexOf("customized=")?(u.customizeSave=!0,u.customizeSaveData=t.data):-1!=t.data.indexOf("customize_changeset_data=")&&(t.data=u.getChangesetData(t.data)))}),c(document).on("ajaxComplete",function(o,e,t){void 0!==e.responseText&&u.customizeSave&&(u.customizeSave=!1,u.ajax("wpglobus_customize_save"))}),c(document).on("ajaxStop",function(){u.customizeSave&&(u.customizeSave=!1,u.ajax("wpglobus_customize_save"))})}};WPGlobusCustomizeOptions=c.extend({},WPGlobusCustomizeOptions,u),WPGlobusCustomizeOptions.init()});