!function(b){"use strict";var p;"undefined"!=typeof WPGlobusWidgets&&(p={saveArbitraryTextOrHTML:!1,editor:{},languageBoxActive:!1,languageBoxTimeout:null,imageWidgets:{},init:function(){p.addElements(),p.attachListeners(),p.arbitraryTextOrHTML()},wysiwygClean:function(){b(".wpglobus-dialog-field").each(function(e,t){var i,o=b(t).data("source-id");1==b("#"+o+"-tmce").length&&(i=b(t).next(".wpglobus_dialog_start"),b(t).remove(),b(i).remove())})},setupWidgetControl:function(o,e,i){var t,a,n,d,l,r,g,s,u,c=!1;b.each(p.editor,function(e,t){if(t.widgetName==o)return!(c=!0)}),c||(""==(a=e.$el[0].id)&&(t=e.$el[0].offsetParent,void 0===(a=b(t).attr("id"))&&b(".widget").each(function(e,t){var i=b(t).attr("id");if(-1!=i.indexOf(o))return a=i,!1})),n="#"+a+" #widget-"+o+"-text",d="#"+a+" #widget-"+o+"-title",p.editor[i.id]={},p.editor[i.id].widgetName=o,p.editor[i.id].controls=e,p.editor[i.id].sourceTitleSelector=d,p.editor[i.id].titleSelector=null,p.editor[i.id].sourceSelector=n,p.editor[i.id].content=b(n).val(),p.editor[i.id].saveSelector="#"+a+" #widget-"+o+"-savewidget",p.editor[i.id].languageSelector="#"+a+" .wpglobus-current-language",p.editor[i.id].inWidgetTitleSelector="#"+a+" .in-widget-title",l=WPGlobusCore.TextFilter(p.editor[i.id].content,WPGlobusCoreData.language,"RETURN_EMPTY"),b("#"+i.id).val(l),g=r="",b.each(WPGlobusCoreData.enabled_languages,function(e,t){r=(r=(r=(r=(r=(r=(r='<a href="#" onclick="return false;" class="item" data-widget-id="{{widgetID}}" data-source="{{source}}" data-editor-id="{{editorID}}" data-language="{{language}}" data-widget-name="{{widgetName}}" style="text-align:center;"><span>{{item}}</span></a>').replace("{{language}}",t)).replace("{{item}}",WPGlobusCoreData.en_language_name[t])).replace("{{widgetName}}",o)).replace("{{widgetID}}",a)).replace("{{editorID}}",i.id)).replace("{{source}}",n),g+=r}),s='<button style="z-index:200000;" type="button" id="'+i.id+'-wpglobus-button" data-widget-id="'+a+'"class="wp-switch-editor switch-wpglobus-language wpglobus-icon-globe"><span class="wpglobus-current-language" data-language="'+WPGlobusCoreData.language+'" style="">'+WPGlobusCoreData.language+'</span></button><div class="wpglobus-language-box" style="position:absolute;top:0;left:0;display:none;z-index:200100;border:1px solid #9e9e9e;border-radius:3px;background-color:#fff;padding: 2px 5px;"><div style="display:flex;flex-direction:column;">'+g+"</div></div>",b("#"+a+" .wp-editor-tabs").append(s),WPGlobusDialogApp.addElement({id:e.fields.title[0].id,style:"width:93%;"})&&(p.editor[i.id].titleSelector="#"+e.fields.title[0].id),p.arbitraryWidgetTitle(i.id),b(n).hasClass("hidden")&&(u=b(n).parent(),b(u).find("div.wpglobus-widgets.wpglobus_dialog_start.wpglobus_dialog_icon").css({display:"none"})))},arbitraryWidgetTitle:function(e){var t=WPGlobusCore.TextFilter(b("#"+p.editor[e].controls.fields.title[0].id).val(),WPGlobusCoreData.language);b(p.editor[e].inWidgetTitleSelector).text(": "+t)},setBoxTimeout:function(){p.languageBoxTimeout=setTimeout(function(){p.languageBoxActive=!1,b(".wpglobus-language-box").css({display:"none"})},1e3)},arbitraryTextOrHTML:function(){function i(e){var t,i,o="",o="keyup"==e.type&&"tinymce"==e.target.id?b(e.target).data("id"):e.target.id;p.editor[o]&&(t=b(p.editor[o].languageSelector).data("language"),i="",i=tinymce.get(o).isHidden()?b("#"+o).val():tinymce.get(o).getContent({format:"raw"}),p.editor[o].content=WPGlobusCore.getString(p.editor[o].content,i,t),b(p.editor[o].sourceSelector).val(p.editor[o].content))}b(document).on("click",".switch-wpglobus-language",function(e){var t,i,o;p.languageBoxActive||(p.languageBoxActive=!0,i=(t=b(this)).data("widget-id"),(o=t.position()).top+=34,o.left+=10,b("#"+i+" .wpglobus-language-box").css({display:"block",top:o.top+"px",left:o.left+"px"}),p.setBoxTimeout())}),b(document).on("mouseenter",".wpglobus-language-box",function(e){clearTimeout(p.languageBoxTimeout)}).on("mouseleave",".wpglobus-language-box",function(e){b(".wpglobus-language-box").css({display:"none"}),p.languageBoxActive=!1}),b(document).on("click",".wpglobus-language-box .item",function(e){var t=b(this),i=t.data("language"),o=t.data("widget-id"),a=t.data("editor-id");b("#"+o+" .wpglobus-current-language").text(i).data("language",i);var n=WPGlobusCore.TextFilter(p.editor[a].content,i,"RETURN_EMPTY");tinymce.get(a).setContent(n,{format:"raw"}),b("textarea#"+a).val(n)}),b(document).on("tinymce-editor-setup",function(e,i){b.each(wp.textWidgets.widgetControls,function(e,t){p.setupWidgetControl(e,t,i)})}),b(document).on("tinymce-editor-init",function(e,t){b(document).on("mouseenter",p.editor[t.id].saveSelector,function(e){b(p.editor[t.id].sourceTitleSelector).val(b(p.editor[t.id].titleSelector).val()),b(p.editor[t.id].sourceSelector).val(p.editor[t.id].content)}),b(document).on("click",p.editor[t.id].saveSelector,function(e){p.saveArbitraryTextOrHTML=t.id}),t.on("nodechange keyup",_.debounce(i,100)),b("#"+t.id).on("keyup",_.debounce(i,100))})},addElements:function(e,t){var i,o=[];o[0]='input[type="text"]',o[1]="textarea",void 0===e||"class"==e?(i=".widget-liquid-right .widget .widget-content",b.each(o,function(e,t){p.makeClone(i,t)})):"id"==e&&(i="#"+t+" .widget-content",b.each(o,function(e,t){p.makeClone(i,t)}))},makeClone:function(e,g){b(e+" "+g).each(function(e,t){var i,o,a,n,d=b(t),l=!1,r=d.attr("id");return void 0===r||-1!=r.indexOf("-number")||""==r||(_.each(WPGlobusWidgets.disabledMask,function(e){if(-1!=r.indexOf(e))return!(l=!0)}),!!l||void(-1!=r.indexOf("-title")&&(n=b("#"+r).clone(),b(d).addClass("wpglobus-dialog-field-source hidden"),i=d.attr("name"),b(n).attr("id","wpglobus-"+r),b(n).attr("name","wpglobus-"+i),b(n).attr("data-source-id",r),b(n).attr("class","wpglobus-dialog-field"),b(n).attr("style","width:90%;"),o=WPGlobusCore.TextFilter(b(d).val(),WPGlobusCoreData.language),b(n).val(o),b('<div style="width:20px;" data-type="control" data-source-type="" data-source-id="'+r+'" class="wpglobus-widgets wpglobus_dialog_start wpglobus_dialog_icon"></div>').insertAfter(d),b(n).insertAfter(d),'input[type="text"]'==g&&""!=o&&(a=d.parents(".widget").attr("id"),b("#"+a+" .in-widget-title").text(": "+o)))))})},attachListeners:function(){b(document).ajaxComplete(function(e,t,i){if(-1!=i.data.indexOf("action=save-widget")&&-1==i.data.indexOf("delete_widget=1")){if(p.saveArbitraryTextOrHTML){var o=WPGlobusCore.TextFilter(p.editor[p.saveArbitraryTextOrHTML].content,b(p.editor[p.saveArbitraryTextOrHTML].languageSelector).data("language"),"RETURN_EMPTY");return tinymce.get(p.saveArbitraryTextOrHTML).isHidden()?(b("#"+p.saveArbitraryTextOrHTML).val(o),b("#"+p.saveArbitraryTextOrHTML+"-tmce").click()):tinymce.get(p.saveArbitraryTextOrHTML).setContent(o,{format:"raw"}),p.arbitraryWidgetTitle(p.saveArbitraryTextOrHTML),void(p.saveArbitraryTextOrHTML=!1)}var a=(a=i.data.split("widget-id="))[1].split("&");b(".widget-liquid-right .widget").each(function(e,t){var i=b(t).attr("id");-1!==i.indexOf(a[0])&&(p.addElements("id",i),p.wysiwygClean())})}}),b("body").on("change",".wpglobus-dialog-field",function(){var i,o,a=b(this),e="#"+a.data("source-id"),n="";i=b(e).val(),/(\{:|\[:|<!--:)[a-z]{2}/.test(i)?(b.each(WPGlobusCoreData.enabled_languages,function(e,t){""!=(o=t==WPGlobusCoreData.language?a.val():WPGlobusCore.TextFilter(i,t,"RETURN_EMPTY"))&&(n+=WPGlobusCore.addLocaleMarks(o,t))}),b(e).val(n)):b(e).val(a.val())}),b(document).on("click",".widget-title, .widget-title-action",function(e){e.preventDefault(),p.wysiwygClean(),p.setImageWidget(this)})},getImageWidgets:function(e){return p.imageWidgets},setImageWidget:function(e){var t=b(e).parents(".widget").attr("id");void 0!==t&&-1!=t.indexOf("media_image")&&void 0===p.imageWidgets[t]&&(b('<hr /><div class="">'+WPGlobusWidgets.l10n.imageWidget.suggest+"</div>").appendTo("#"+t+" .widget-inside"),p.imageWidgets[t]=!0)},__getEditorContent:function(){if(0!=Object.keys(p.editor).length)for(var o in console.log("WPGlobusWidgets editors length is: ",Object.keys(p.editor).length),p.editor)console.log("editor        : ",o," -> widgetName: ",p.editor[o].widgetName),console.log("source content: ",p.editor[o].content),b.each(WPGlobusCoreData.enabled_languages,function(e,t){console.log("Language: ",t);var i=WPGlobusCore.TextFilter(p.editor[o].content,t,"RETURN_EMPTY");""==i?console.log("empty"):console.log("Content: ",i)}),console.log("--------------------");else console.log("WPGlobusWidgets editors length is: 0")},__getEditorLanguage:function(){if(0!=Object.keys(p.editor).length)for(var e in console.log("WPGlobusWidgets editors length is: ",Object.keys(p.editor).length),p.editor)console.log("editor           : ",e," -> widgetName: ",p.editor[e].widgetName),console.log("current language : ",b(p.editor[e].languageSelector).data("language")),console.log("--------------------");else console.log("WPGlobusWidgets editors length is: 0")}},WPGlobusWidgets=b.extend({},WPGlobusWidgets,p))}(jQuery);